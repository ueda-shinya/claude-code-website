# Webサイト制作マルチエージェントチーム

ユーザーからWebサイト制作の依頼があったら、以下のワークフローに従って
**Task ツールでサブエージェントを起動し**、チームで協力してサイトを制作する。

## 出力先
- 作業ファイル: `workspace/`
- 最終成果物: `output/{案件名}/index.html`, `output/{案件名}/assets/css/styles.css`, `output/{案件名}/assets/js/script.js`

---

## ワークフロー

```
Phase 0  ヒアリング（自分）
  ↓
Phase 1  PM → 仕様書
  ↓
Phase 2  マーケター → 戦略書（セクション構成・CV設計・反論処理）
  ↓ 戦略書を受け取って
Phase 3  セールスライター → 全コピー（実際の文章のみ）
  ↓ 戦略書＋コピーを受け取って
Phase 4  UI/UXデザイナー → デザインシステム（視覚仕様のみ）
  ↓ 3ファイル全部を受け取って
Phase 5  HTMLデザイナー → 完全なHTML
  ↓
Phase 6  ┌─ スタイリスト → styles.css
（並列）  ├─ フロントエンドエンジニア → script.js
         └─ バックエンドエンジニア → form_handler.php
  ↓
Phase 7  SEO担当 → seo強化済みHTML
  ↓
Phase 8  ┌─ コードレビュー → review_code.md
（並列）  └─ QA → review_qa.md
  ↓
Phase 9  最終組み立て（自分）→ output/
```

---

### Phase 0 — インタラクティブヒアリング（制作開始前に必ず実行）

ユーザーからWebサイト制作の依頼があったら、まず `hearing_sheet.md` を読み込む。

#### 対話型ヒアリングの進め方

1. **空欄の検出**
   `hearing_sheet.md` を読み、回答が空・「未定」・未チェックの項目を全て洗い出す。

2. **セクションごとに順番に質問する**
   空欄が多くても一度に全部聞かず、**1セクションずつ進める**。
   各セクションの冒頭に「〇〇について確認します」と宣言してから質問する。

3. **各質問の形式**
   空欄の項目ごとに、**すでに記入された他の情報から推測した提案を3つ**と
   「その他（自由入力）」を必ずセットで提示する。

   ```
   例）業種が「カフェ」と記入されている場合の「デザインスタイル」の質問:

   デザインの雰囲気はどのようにしますか？

   1. ナチュラル・温かみ  — 木目・グリーン・手書き風フォントで居心地の良さを表現
   2. スタイリッシュ・都会的 — モノトーン＋アクセントカラーでトレンド感を演出
   3. ポップ・カジュアル  — 明るい配色とイラストで気軽に入れる雰囲気を表現
   4. その他（自由に教えてください）
   ```

4. **回答の即時反映**
   クライアントが選択・回答したら、その内容を `hearing_sheet.md` に書き込んでから次の質問へ進む。
   「1」「2」「3」の数字だけの回答でも対応する。

5. **提案の根拠**
   提案3つは必ず「既記入の情報（業種・ターゲット・目的など）」から論理的に導くこと。
   汎用的な選択肢ではなく、そのクライアント固有の文脈に合わせる。

6. **全項目が埋まったら確認**
   全セクションのヒアリングが完了したら、記入内容をサマリーして確認を取る:
   > 「以上の内容で制作を進めてよいですか？修正があればお知らせください。」
   確認が取れたら Phase 1 へ進む。

#### 既に全て記入済みの場合
`hearing_sheet.md` の内容を確認し、不明点があれば上記の形式で最大3点だけ質問する。
問題なければ即 Phase 1 へ進む。

---

### Phase 1 — PM（自分で実行）
`hearing_sheet.md` の内容をベースに、以下を含む仕様書を `workspace/01_spec.md` に作成する:
- ビジネス目標・ターゲット・バリュープロポジション
- ページ構成・セクション一覧（暫定順）
- デザイン方向性（カラー・フォント・スタイル）
- 必要な機能・インタラクション
- ブランドボイス・トーン

---

### Phase 2 — マーケター（Task ツール）

**役割:** 「何を・誰に・なぜ行動させるか」の戦略オーナー。
**参照:** `workspace/01_spec.md`
**出力:** `workspace/02_marketing.md`

**書くこと（A = このエージェントが最終責任者）:**
- ターゲット詳細：ペルソナ・課題・意思決定要因・行動障壁（不安・反論）
- USP・差別化ポイント・オファー設計
- セクション構成の最終決定（順序・各セクションの説得目的）
- CV定義：メインCTA・サブCTA・KPI
- ファネル設計：流入→ページ→CV→次のアクション
- 反論処理の方針（「高い」「怪しい」「自分に合わない」への答え方）
- 証拠・信頼シグナルの選定（何を・どこで・どう使うか）
- 感情的トリガーと訴求の優先順位

**書いてはいけないこと:**
- 実際のキャッチコピーや本文（文章の完成形）
- CSS・レイアウト・デザインの具体的指定

---

### Phase 3 — セールスライター（Task ツール）

**役割:** マーケター戦略を「言葉で行動に変える」説得オーナー。
**参照:** `workspace/01_spec.md`, `workspace/02_marketing.md`
**出力:** `workspace/03_copy.md`

**書くこと（A = このエージェントが最終責任者）:**
- Big Idea・約束・トーン&マナー・禁止ワード
- 全セクションの完成コピー（見出し・本文・箇条書き・CTA文言・フォームラベル・FAQ・フッター）
  ※ プレースホルダー禁止。実際に使えるテキストのみ。
- 反論処理の文章化（マーケターの方針を実際の言葉に落とす）
- 証拠・実績の言語化（数字・事例・証言の文章）
- スクロールの「引き」設計（読ませる順序・次を読ませる仕掛け）

**書いてはいけないこと:**
- セクション構成の変更（変更提案はメモとして添えてよいが従う必要はない）
- デザイン・レイアウト・CSSの指定

---

### Phase 4 — UI/UXデザイナー（Task ツール）

**役割:** コピーと構成を「最速で理解・行動できる視覚体験」に変えるデザインオーナー。
**参照:** `workspace/01_spec.md`, `workspace/02_marketing.md`, `workspace/03_copy.md`
**出力:** `workspace/04_ux.md`

> **コピーを読んでからデザインする。** 文字量・見出し階層・CTAの数を把握した上で
> レイアウトを決めること。コピーを変えてはいけない。

**書くこと（A = このエージェントが最終責任者）:**
- カラーシステム（HEXコード付き CSS 変数定義）
- タイポグラフィスケール（rem値・font-weight・line-height）
- スペーシングシステム・グリッド・ブレークポイント（375px / 768px / 1280px）
- セクション別レイアウト仕様（SP/TAB/PC それぞれ）
- コンポーネント仕様（ボタン・カード・フォーム・アコーディオン・ナビ）
- アニメーション・トランジション仕様
- 信頼設計（実績・証言・数字の視覚的見せ方）
- CTA/フォームのUX（入力負荷・エラー表示・スマホ最適化）

**書いてはいけないこと:**
- コピーの書き換え（長すぎる場合は「短縮推奨」とメモするだけ）
- マーケティング戦略の変更

---

### Phase 5 — HTMLデザイナー（Task ツール）

**参照:** `workspace/01_spec.md`, `workspace/02_marketing.md`, `workspace/03_copy.md`, `workspace/04_ux.md`
**出力:** `workspace/05_index.html`

完全な HTML を作成する:
- セマンティックHTML5（header / nav / main / section / footer）
- **FLOCSS命名規則**のクラス名（後述）
- `03_copy.md` のコピーをそのまま使用（一字も変えない）
- `04_ux.md` のクラス名・構造を忠実に反映
- `assets/css/styles.css` と `assets/js/script.js` をリンク
- フォームは `php/form_handler.php` へ POST

---

### Phase 6 — 並列（Task ツールで3エージェントを同時起動）

以下の3つを **1つのメッセージで並列に** Task ツール呼び出しする:

**スタイリスト** (`workspace/06_styles.css`)
- `workspace/04_ux.md` のデザインシステムを CSS に実装
- `workspace/05_index.html` のクラス名に完全一致させること（整合性最優先）
- CSS カスタムプロパティ（--変数）でデザインシステム定義
- モバイルファースト（min-widthメディアクエリのみ）
- 外部依存なし（純粋CSS）

**フロントエンドエンジニア** (`workspace/06_script.js`)
- `workspace/05_index.html` の構造・クラス名・data属性に完全一致するセレクターを使うこと
- バニラJS（ES6+、ライブラリなし）
- ハンバーガーメニュー・スムーズスクロール・スクロールリビール
- フォームバリデーション・送信処理・Honeypot

**バックエンドエンジニア** (`workspace/06_form_handler.php`)
- フォームハンドラー（セキュリティ・ログ・メール送信）
- CLAUDE.md のフォームセキュリティ要件を全て実装

---

### Phase 7 — SEO担当者（Task ツール）

`workspace/05_index.html` を強化して `workspace/07_seo.html` を作成:
- タイトル・メタディスクリプション・OGP・Twitter Card
- JSON-LD構造化データ（CafeOrRestaurant・FAQPage・WebSite）
- h1が1つ、見出し階層が正しいことを確認
- skip ナビ・aria-label・画像の alt/width/height

---

### Phase 8 — 並列（Task ツールで2エージェントを同時起動）

**コードレビュー** (`workspace/08_review_code.md`)
- HTML・CSS・JSの整合性（クラス名・IDの一致）
- セキュリティ（XSS・インラインイベントハンドラ・PHP）
- アクセシビリティ（ARIA・altテキスト・フォームラベル）
- 問題点を 🔴CRITICAL / 🟡WARNING / 🟢INFO で分類

**QA** (`workspace/08_review_qa.md`)
- 仕様書（01_spec.md）との照合
- コピー（03_copy.md）との照合（テキストが正確に入っているか）
- ブランドボイスの遵守確認
- 問題点を HIGH / MEDIUM / LOW で分類

---

### Phase 9 — 最終組み立て（自分で実行）

レビュー結果（`08_review_code.md`, `08_review_qa.md`）を読み、
🔴CRITICAL / HIGH の修正を適用した上で、**ファイル管理ルール**に従って納品物を書き出す。

---

## 役割のRACIルール

各成果物の最終責任者（A = Accountable）は1人だけ。後のフェーズのエージェントは
相談（C）はされるが、Aの成果物を上書きしてはいけない。

| 成果物 | A（最終責任者） | C（相談される人） |
|--------|----------------|------------------|
| セクション構成・CV設計 | マーケター | ライター |
| コピー文言（見出し・本文・CTA） | セールスライター | マーケター・デザイナー |
| デザインシステム・レイアウト | デザイナー | マーケター・ライター |
| CTA 文言 | セールスライター | — |
| CTA 配置・UI | デザイナー | セールスライター |
| 証拠・信頼シグナルの選定 | マーケター | — |
| 証拠の文章化 | セールスライター | マーケター |
| 証拠の視覚化 | デザイナー | マーケター |

---

## エージェントへの指示の原則

- 各 Task エージェントには **役割・参照ファイルの内容・出力ファイル名** を明示する
- **前フェーズの成果物をプロンプトに含めて渡す**（ファイルパスだけでなく内容も）
- HTMLエージェントには `03_copy.md` のコピーをそのまま渡す（プレースホルダー排除）
- CSSエージェントには `05_index.html` のクラス名・data属性一覧を渡す（整合性確保）
- JSエージェントには `05_index.html` の構造・クラス名・data属性を渡す（セレクター整合性確保）
- `general-purpose` エージェントタイプを使用する

---

## 制作品質ルール

全エージェントは以下のルールを**絶対に守る**こと。レビュワーはこのルールへの準拠を必ず確認する。

### モバイルファースト（必須）
- CSS は `min-width` メディアクエリのみ使用（`max-width` 禁止）
- 基準ブレークポイント: 375px（スマホ）→ 768px（タブレット）→ 1280px（デスクトップ）
- タップターゲットは最小 44px × 44px

### パフォーマンス基準
- 外部CSSライブラリ・JSライブラリの読み込み禁止（バニラのみ）
- CSSアニメーションは `transform` と `opacity` のみ使用（`top/left/width` などlayoutプロパティ禁止）
- フォールド以下の画像は `loading="lazy"` を必ず付与
- `<link rel="preload">` でクリティカルなフォントを先読み

### CSSクラス命名規則：FLOCSS
以下のレイヤー構造と命名規則を厳守する:

```
Foundation  : リセット・ベーススタイル（クラスなし、要素セレクタのみ）
Layout      : l-header / l-footer / l-main / l-sidebar  （プレフィックス: l-）
Component   : c-button / c-card / c-form               （プレフィックス: c-）
Project     : p-hero / p-about / p-service / p-contact  （プレフィックス: p-）
Utility     : u-mt-16 / u-text-center / u-hidden        （プレフィックス: u-）
```

- Modifier は `c-button--primary` のようにダブルハイフン
- 状態変化は `is-active` / `is-open` / `is-error` のように `is-` プレフィックス

### クラス名整合性ルール（Phase 5〜6 必須）
HTMLデザイナーが確定させたクラス名が「唯一の真実」。
CSS・JSはそのクラス名に合わせる。クラス名の変更は HTML 側で行う。

### フォームセキュリティ（必須）
入力フォームが1つでもある場合、以下を**全て実装**すること:

**フロントエンド（script.js）:**
- 全入力値をHTMLエスケープ処理してからDOMに挿入（`innerHTML` 禁止、`textContent` を使用）
- 送信ボタンの二重送信防止（送信後に `disabled` 化）
- クライアントサイドバリデーション（メール形式・必須チェック・文字数制限）
- reCAPTCHA v3 または Honeypot フィールドによるbot対策

**バックエンド（php/form_handler.php）:**
- `htmlspecialchars()` によるXSSサニタイズ
- `filter_var()` によるメールアドレス検証
- IPベースのレート制限（同一IPから60秒以内に3回以上の送信をブロック）
- POSTメソッド・Content-Typeの確認（CSRFトークン検証推奨）

### フォームログ（必須）
フォームの全送信試行を `logs/form_log.txt` に記録すること。

**ログ形式（1行1件、TSV）:**
```
{ISO8601日時}  {IPアドレス}  {ステータス}  {名前}  {メールアドレス}  {UA}
```

**ステータスの種類:**
- `SUCCESS`  : 正常送信完了
- `BLOCKED`  : セキュリティ機能（レート制限・bot検知）によりブロック
- `ERROR`    : バリデーションエラーで送信不可
- `SPAM`     : スパム判定でブロック

**実装例（PHP）:**
```php
function write_form_log(string $status, array $data): void {
    $log_dir = __DIR__ . '/../logs';
    if (!is_dir($log_dir)) mkdir($log_dir, 0750, true);
    $line = implode("\t", [
        date('c'),
        $_SERVER['REMOTE_ADDR'] ?? 'unknown',
        $status,
        $data['name']  ?? '',
        $data['email'] ?? '',
        $_SERVER['HTTP_USER_AGENT'] ?? '',
    ]);
    file_put_contents($log_dir . '/form_log.txt', $line . PHP_EOL, FILE_APPEND | LOCK_EX);
}
```

> **注意:** `logs/` ディレクトリは `.htaccess` でブラウザから直接アクセスできないよう保護すること。

---

## ファイル管理ルール

### 案件ごとのフォルダ構成
納品物は `output/{案件名}/` に格納する。案件名はヒアリングシートの「サイト名」を使用。

```
output/
└── {案件名}/
    ├── index.html
    ├── assets/
    │   ├── css/
    │   │   └── styles.css
    │   ├── js/
    │   │   └── script.js
    │   └── images/
    │       └── （画像プレースホルダー一覧.md）
    ├── php/
    │   └── form_handler.php    ← フォームがある場合のみ
    ├── logs/
    │   └── .htaccess           ← ブラウザアクセス禁止
    └── README.md
```

### README.md の必須記載内容
```markdown
# {サイト名}

## 概要
{業種・目的の1〜2文}

## ファイル構成
{ファイルツリー}

## フォーム設定
- 送信先メール: {hearing_sheet.md の値}
- ログ保存先: logs/form_log.txt

## 動作確認環境
- Chrome / Safari / Firefox 最新版
- iOS Safari / Android Chrome

## 納品日
{日付}
```

### 既存 output/ の上書き禁止
同名フォルダが既に存在する場合は上書きせず、`{案件名}_v2/` のように連番で保存すること。

### workspace/ の自動リセット
新しい案件を開始する前に `workspace/` の内容を削除してよいか確認する:
> 「前回の workspace/ が残っています。削除して新しい案件を始めますか？」

---

## XAMPPプレビュー
完成後は以下のURLで確認できる:
`http://localhost/claude-code-website/output/{案件名}/`
